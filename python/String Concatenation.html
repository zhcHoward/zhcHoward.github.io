<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>String Concatenation | Welcome to my castle in the sky</title>
    <meta name="description" content="A blog about python, vue and linux.">
    
    
    <link rel="preload" href="/assets/css/0.styles.f86987ee.css" as="style"><link rel="preload" href="/assets/js/app.d7ebc9be.js" as="script"><link rel="preload" href="/assets/js/4.1d476ea8.js" as="script"><link rel="prefetch" href="/assets/js/2.da8a4420.js"><link rel="prefetch" href="/assets/js/3.a5fd17e9.js"><link rel="prefetch" href="/assets/js/5.7c61494f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f86987ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Welcome to my castle in the sky</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>String Concatenation</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/python/String%20Concatenation.html#str-join-is-always-better-than" class="sidebar-link">str.join() is always better than +?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/python/String%20Concatenation.html#so-we-should-use-instead-of-str-join" class="sidebar-link">So, we should use + instead of str.join()?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/python/String%20Concatenation.html#let-us-compare-again" class="sidebar-link">Let us compare again</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/python/String%20Concatenation.html#what-happened" class="sidebar-link">What happened?</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/python/String%20Concatenation.html#conclusion" class="sidebar-link">Conclusion</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="string-concatenation"><a href="#string-concatenation" aria-hidden="true" class="header-anchor">#</a> String Concatenation</h1> <h2 id="str-join-is-always-better-than"><a href="#str-join-is-always-better-than" aria-hidden="true" class="header-anchor">#</a> <code>str.join()</code> is always better than <code>+</code>?</h2> <p>Python has 2 common ways to concatenate strings. One is to use <code>+</code> operator, another is to use <code>str.join()</code> method. While learning Python, I heard a lot voices telling me that:</p> <blockquote><p>In Python, it is always more efficient to concatenate strings using <code>str.join()</code> method instead of <code>+</code> operator.</p></blockquote> <p>However, someone show me a demo:</p> <div class="language-python extra-class"><pre class="language-python"><code>Python <span class="token number">3.7</span><span class="token number">.1</span> <span class="token punctuation">(</span>default<span class="token punctuation">,</span> Nov  <span class="token number">6</span> <span class="token number">2018</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">:</span><span class="token number">46</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">)</span>
Type <span class="token string">'copyright'</span><span class="token punctuation">,</span> <span class="token string">'credits'</span> <span class="token operator">or</span> <span class="token string">'license'</span> <span class="token keyword">for</span> more information
IPython <span class="token number">7.1</span><span class="token number">.1</span> <span class="token operator">-</span><span class="token operator">-</span> An enhanced Interactive Python<span class="token punctuation">.</span> Type <span class="token string">'?'</span> <span class="token keyword">for</span> <span class="token builtin">help</span><span class="token punctuation">.</span>

In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>

In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token string">'a'</span> <span class="token operator">+</span> <span class="token string">'b'</span> <span class="token operator">+</span> <span class="token string">'c'</span>
   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>

In <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>timeit a<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">243</span> ns ± <span class="token number">3.99</span> ns per loop <span class="token punctuation">(</span>mean ± std<span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of <span class="token number">7</span> runs<span class="token punctuation">,</span> <span class="token number">1000000</span> loops each<span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>timeit b<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">74.1</span> ns ± <span class="token number">2.94</span> ns per loop <span class="token punctuation">(</span>mean ± std<span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of <span class="token number">7</span> runs<span class="token punctuation">,</span> <span class="token number">10000000</span> loops each<span class="token punctuation">)</span>
</code></pre></div><p>This demo uses <code>str.join()</code> and <code>+</code> seperatly to concatenate 3 characters: a, b, c. Then, measuring how long each function takes to finish using IPython's built-in magic command <code>%timeit</code>. The average time of running  <code>str.join()</code> is about 243 ns and running  <code>+</code> is about 74.1 ns. Apparently, <code>str.join()</code> is much slower than <code>+</code>.</p> <h2 id="so-we-should-use-instead-of-str-join"><a href="#so-we-should-use-instead-of-str-join" aria-hidden="true" class="header-anchor">#</a> So, we should use <code>+</code> instead of <code>str.join()</code>?</h2> <p>Hold on a second, let's see what really happens when you call <code>a()</code> and <code>b()</code>. With the help of Python built-in module <code>dis</code>, we can see clearly the bytecode operation of each function.</p> <div class="language-python extra-class"><pre class="language-python"><code>In <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">import</span> dis

In <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dis<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  <span class="token number">2</span>           <span class="token number">0</span> LOAD_CONST               <span class="token number">1</span> <span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
              <span class="token number">2</span> LOAD_METHOD              <span class="token number">0</span> <span class="token punctuation">(</span>join<span class="token punctuation">)</span>
              <span class="token number">4</span> LOAD_CONST               <span class="token number">2</span> <span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
              <span class="token number">6</span> LOAD_CONST               <span class="token number">3</span> <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>
              <span class="token number">8</span> LOAD_CONST               <span class="token number">4</span> <span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>
             <span class="token number">10</span> BUILD_LIST               <span class="token number">3</span>
             <span class="token number">12</span> CALL_METHOD              <span class="token number">1</span>
             <span class="token number">14</span> RETURN_VALUE

In <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dis<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>b<span class="token punctuation">)</span>
  <span class="token number">2</span>           <span class="token number">0</span> LOAD_CONST               <span class="token number">1</span> <span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>
              <span class="token number">2</span> RETURN_VALUE
</code></pre></div><p>When we call <code>a()</code>, actually, most of time is spent on <code>LOAD_CONST</code> and <code>BUILD_LIST</code>. From the name, we can tell that these 2 operations are not concatenating strings, they are constructing a list <code>['a', 'b', 'c']</code> to be used as the parameter for <code>str.join()</code>. When we call <code>b()</code>, line  <code>return 'a' + 'b' + 'c'</code>  is turned into <code>return 'abc'</code> during compiling time due to Python compiler's optimization (I guess). Because <code>dis(b)</code> and <code>dis(f)</code> below return the same result.</p> <div class="language-python extra-class"><pre class="language-python"><code>In <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token string">'abc'</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>
        
In <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dis<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token number">2</span>           <span class="token number">0</span> LOAD_CONST               <span class="token number">1</span> <span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>
              <span class="token number">2</span> RETURN_VALUE
</code></pre></div><p>This comparation is not actually not fair. The total time of running <code>a()</code> is the time of <code>str.join()</code> and constructing list. And the  string in <code>b()</code> is concatenated during compile time instead of runtime.</p> <h2 id="let-us-compare-again"><a href="#let-us-compare-again" aria-hidden="true" class="header-anchor">#</a> Let us compare again</h2> <div class="language-python extra-class"><pre class="language-python"><code>In <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a <span class="token operator">=</span> <span class="token string">'a'</span>

In <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">:</span> b <span class="token operator">=</span> <span class="token string">'b'</span>

In <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span> c <span class="token operator">=</span> <span class="token string">'c'</span>

In <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">d</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>a <span class="token punctuation">,</span>b <span class="token punctuation">,</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>

In <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> c
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>

In <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>timeit d<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">267</span> ns ± <span class="token number">1.16</span> ns per loop <span class="token punctuation">(</span>mean ± std<span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of <span class="token number">7</span> runs<span class="token punctuation">,</span> <span class="token number">1000000</span> loops each<span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>timeit e<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">210</span> ns ± <span class="token number">2.81</span> ns per loop <span class="token punctuation">(</span>mean ± std<span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of <span class="token number">7</span> runs<span class="token punctuation">,</span> <span class="token number">1000000</span> loops each<span class="token punctuation">)</span>
</code></pre></div><p>It seems <code>+</code> is still faster, so, we should use <code>+</code> instead of <code>str.join()</code>? Let's see another demo, this time, we contatenate more strings.</p> <div class="language-python extra-class"><pre class="language-python"><code>In <span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

In <span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>

In <span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">def</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">997</span><span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">998</span><span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">999</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">:</span>

In <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>timeit b<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">6.98</span> µs ± <span class="token number">86.8</span> ns per loop <span class="token punctuation">(</span>mean ± std<span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of <span class="token number">7</span> runs<span class="token punctuation">,</span> <span class="token number">100000</span> loops each<span class="token punctuation">)</span>

In <span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>timeit c<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">102</span> µs ± <span class="token number">7.01</span> µs per loop <span class="token punctuation">(</span>mean ± std<span class="token punctuation">.</span> dev<span class="token punctuation">.</span> of <span class="token number">7</span> runs<span class="token punctuation">,</span> <span class="token number">10000</span> loops each<span class="token punctuation">)</span>
</code></pre></div><p>This time <code>str.join()</code> is much faster than <code>+</code>.</p> <h2 id="what-happened"><a href="#what-happened" aria-hidden="true" class="header-anchor">#</a> What happened?</h2> <p>Let's see the <code>dis()</code> result of second demo:</p> <div class="language-python extra-class"><pre class="language-python"><code>In <span class="token punctuation">[</span><span class="token number">63</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dis<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
  <span class="token number">2</span>           <span class="token number">0</span> LOAD_CONST               <span class="token number">1</span> <span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
              <span class="token number">2</span> LOAD_METHOD              <span class="token number">0</span> <span class="token punctuation">(</span>join<span class="token punctuation">)</span>
              <span class="token number">4</span> LOAD_GLOBAL              <span class="token number">1</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
              <span class="token number">6</span> LOAD_GLOBAL              <span class="token number">2</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span>
              <span class="token number">8</span> LOAD_GLOBAL              <span class="token number">3</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span>
             <span class="token number">10</span> BUILD_LIST               <span class="token number">3</span>
             <span class="token number">12</span> CALL_METHOD              <span class="token number">1</span>
             <span class="token number">14</span> RETURN_VALUE

In <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">:</span> dis<span class="token punctuation">.</span>dis<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token number">2</span>           <span class="token number">0</span> LOAD_GLOBAL              <span class="token number">0</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span>
              <span class="token number">2</span> LOAD_GLOBAL              <span class="token number">1</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span>
              <span class="token number">4</span> BINARY_ADD
              <span class="token number">6</span> LOAD_GLOBAL              <span class="token number">2</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span>
              <span class="token number">8</span> BINARY_ADD
             <span class="token number">10</span> RETURN_VALUE
</code></pre></div><p>From output above, we can conclude that to concatenate $$N$$ strings, the total number of operations for <code>str.join</code> is</p> <p>$$
N + 5
$$</p> <p>but for <code>+</code> is</p> <p>$$
N + (N-1) + 1 =&gt; 2N
$$</p> <p>When $$N$$ is less than 5, <code>+</code> will be faster than <code>str.join()</code>. However, once $$N$$ is larger than 5, <code>str.join()</code> become more and more efficient than <code>+</code>. This explains why when concatenating 3 strings <code>+</code> is still faster, but it become much slower when concatenation 1000 strings.</p> <h2 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h2> <p>Whenever you want to concatenate strings in Python, use <code>str.join()</code>.</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.d7ebc9be.js" defer></script><script src="/assets/js/4.1d476ea8.js" defer></script>
  </body>
</html>
