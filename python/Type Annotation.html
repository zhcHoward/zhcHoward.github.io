<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Type Annotation | Laputa</title>
    <meta name="description" content="A blog about python, vue and linux.">
    
    
    <link rel="preload" href="/assets/css/0.styles.b843839c.css" as="style"><link rel="preload" href="/assets/js/app.4e97592e.js" as="script"><link rel="preload" href="/assets/js/2.015f60de.js" as="script"><link rel="preload" href="/assets/js/7.1fc22ddf.js" as="script"><link rel="prefetch" href="/assets/js/3.238746e1.js"><link rel="prefetch" href="/assets/js/4.de43a06e.js"><link rel="prefetch" href="/assets/js/5.7d8a7716.js"><link rel="prefetch" href="/assets/js/6.66ddb4fd.js"><link rel="prefetch" href="/assets/js/8.c8fd2d09.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b843839c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Laputa</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Type Annotation</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/python/Type%20Annotation.html#undefined-name" class="sidebar-link">undefined name</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/python/Type%20Annotation.html#incompatible-types-in-assignment" class="sidebar-link">Incompatible types in assignment</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/python/Type%20Annotation.html#unsupported-operand-types" class="sidebar-link">Unsupported operand types</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/python/Type%20Annotation.html#item-xxx-of-union-xxx-yyy-has-no-attribute-zzz" class="sidebar-link">Item &quot;xxx&quot; of &quot;Union[xxx, yyy]&quot; has no attribute &quot;zzz&quot;</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content default"><h1 id="type-annotation"><a href="#type-annotation" aria-hidden="true" class="header-anchor">#</a> Type Annotation</h1> <p>Recently, I start a project with Python3 and try out one of Python3's new features: type annotation. Here is some issues I encounter during working on this project as well as their solutions.</p> <p>Even throught Python3 supports type annotation, the python compiler itself will not check the type of variables in your code. So, you need a third party static type checker. What I use is <a href="http://www.mypy-lang.org/" target="_blank" rel="noopener noreferrer">mypy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. The version of python I am using is <strong>3.7.2</strong>. If you are using a different version of python, my solutions may not work for you.</p> <h2 id="undefined-name"><a href="#undefined-name" aria-hidden="true" class="header-anchor">#</a> undefined name</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Line</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span> k<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>k <span class="token operator">=</span> k
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> b
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> a

    @<span class="token builtin">classmethod</span>
    <span class="token keyword">def</span> <span class="token function">from_points</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> p1<span class="token punctuation">:</span> Point<span class="token punctuation">,</span> p2<span class="token punctuation">:</span> Point<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Line<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Construct a line from 2 given points&quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            k <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
            b <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">*</span> p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>x <span class="token operator">*</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
            a <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>
            k <span class="token operator">=</span> <span class="token boolean">None</span>
            b <span class="token operator">=</span> <span class="token boolean">None</span>
            a <span class="token operator">=</span> p1<span class="token punctuation">.</span>x
        <span class="token keyword">return</span> cls<span class="token punctuation">(</span>k<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>The code above looks fine. However, if you check you code with tools like flake8, it will complain that</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>44,51,F,F821:undefined name 'Line'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>And, if you try to run this code, a error will be raised:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>Exception has occurred<span class="token punctuation">:</span> NameError
name <span class="token string">'Line'</span> <span class="token keyword">is</span> <span class="token operator">not</span> defined
  File <span class="token string">&quot;/Users/howard/Workspaces/Python/Advent_of_Code/utils.py&quot;</span><span class="token punctuation">,</span> line <span class="token number">44</span><span class="token punctuation">,</span> <span class="token keyword">in</span> Line
    <span class="token keyword">def</span> <span class="token function">from_points</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> p1<span class="token punctuation">:</span> Point<span class="token punctuation">,</span> p2<span class="token punctuation">:</span> Point<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Line<span class="token punctuation">:</span>
  File <span class="token string">&quot;/Users/howard/Workspaces/Python/Advent_of_Code/utils.py&quot;</span><span class="token punctuation">,</span> line <span class="token number">37</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    <span class="token keyword">class</span> <span class="token class-name">Line</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>The reason this happens is that <code>Line</code> is used before the definition of class <code>Line</code> is completed.</p> <p>To solve this problem, you need to add</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>in the beginning of your code. The detailed info can be found in <a href="https://www.python.org/dev/peps/pep-0563/" target="_blank" rel="noopener noreferrer">PEP-563<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>However, even so, flake8 may still complains that <code>Line</code> is not defined. This is because flake(3.6.0) does not fully support this syntax yet. A workaround is to turn class <code>Line</code> into a string.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">from_points</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> p1<span class="token punctuation">:</span> Point<span class="token punctuation">,</span> p2<span class="token punctuation">:</span> Point<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">&quot;Line&quot;</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="incompatible-types-in-assignment"><a href="#incompatible-types-in-assignment" aria-hidden="true" class="header-anchor">#</a> Incompatible types in assignment</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Line</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span> k<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>k <span class="token operator">=</span> k
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> b
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> a

    @<span class="token builtin">classmethod</span>
    <span class="token keyword">def</span> <span class="token function">from_points</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> p1<span class="token punctuation">:</span> Point<span class="token punctuation">,</span> p2<span class="token punctuation">:</span> Point<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">&quot;Line&quot;</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;Construct a line from 2 given points&quot;&quot;&quot;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            k <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
            b <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">*</span> p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>x <span class="token operator">*</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
            a <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>
            k <span class="token operator">=</span> <span class="token boolean">None</span>
            b <span class="token operator">=</span> <span class="token boolean">None</span>
            a <span class="token operator">=</span> p1<span class="token punctuation">.</span>x
        <span class="token keyword">return</span> cls<span class="token punctuation">(</span>k<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>After fix first error, there are still some other errors:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>utils.py:53: error: Incompatible types in assignment (expression has type &quot;None&quot;, variable has type &quot;float&quot;)
utils.py:54: error: Incompatible types in assignment (expression has type &quot;None&quot;, variable has type &quot;float&quot;)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>In my souce code, the lines contains errors are 53 and 54, but in the demo above, they are actually line 17 and 18. The cause of this error is that the first value you assign to <code>k</code> is <code>(p1.y - p2.y) / (p1.x - p2.x)</code>. This implies <code>k</code> is a <code>float</code> variable and mypy will check if <code>k</code> is <code>float</code> or not for the rest of code. To avoid this behaviour, you need to explicitly declare the type of <code>k</code>. You can do it in 2 ways:</p> <ol><li><p>Declare the type of variable in code:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">from_points</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> p1<span class="token punctuation">:</span> Point<span class="token punctuation">,</span> p2<span class="token punctuation">:</span> Point<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">&quot;Line&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        k<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        b<span class="token punctuation">:</span> Optional<span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">*</span> p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>x <span class="token operator">*</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
        a <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>
        k <span class="token operator">=</span> <span class="token boolean">None</span>
        b <span class="token operator">=</span> <span class="token boolean">None</span>
        a <span class="token operator">=</span> p1<span class="token punctuation">.</span>x

    <span class="token keyword">return</span> cls<span class="token punctuation">(</span>k<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>Declare the type of variable in comment:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">from_points</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> p1<span class="token punctuation">:</span> Point<span class="token punctuation">,</span> p2<span class="token punctuation">:</span> Point<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">&quot;Line&quot;</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>  <span class="token comment"># type: Optional[float]</span>
        b <span class="token operator">=</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">*</span> p2<span class="token punctuation">.</span>y <span class="token operator">-</span> p2<span class="token punctuation">.</span>x <span class="token operator">*</span> p1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>p1<span class="token punctuation">.</span>x <span class="token operator">-</span> p2<span class="token punctuation">.</span>x<span class="token punctuation">)</span>  <span class="token comment"># type: Optional[float]</span>
        a <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>
        k <span class="token operator">=</span> <span class="token boolean">None</span>
        b <span class="token operator">=</span> <span class="token boolean">None</span>
        a <span class="token operator">=</span> p1<span class="token punctuation">.</span>x
    <span class="token keyword">return</span> cls<span class="token punctuation">(</span>k<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol> <h2 id="unsupported-operand-types"><a href="#unsupported-operand-types" aria-hidden="true" class="header-anchor">#</a> Unsupported operand types</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">y</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">float</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>a <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>k <span class="token operator">*</span> x <span class="token operator">+</span> self<span class="token punctuation">.</span>b
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>a
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>y</code> is a member of class <code>Line</code>. Mypy keeps complaining an error for line 3:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>utils<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span> error<span class="token punctuation">:</span> Unsupported operand types <span class="token keyword">for</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token string">&quot;None&quot;</span> <span class="token operator">and</span> <span class="token string">&quot;float&quot;</span><span class="token punctuation">)</span>
utils<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span> note<span class="token punctuation">:</span> Left operand <span class="token keyword">is</span> of <span class="token builtin">type</span> <span class="token string">&quot;Optional[float]&quot;</span>
utils<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span> error<span class="token punctuation">:</span> Unsupported operand types <span class="token keyword">for</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">&quot;float&quot;</span> <span class="token operator">and</span> <span class="token string">&quot;None&quot;</span><span class="token punctuation">)</span>
utils<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">61</span><span class="token punctuation">:</span> note<span class="token punctuation">:</span> Right operand <span class="token keyword">is</span> of <span class="token builtin">type</span> <span class="token string">&quot;Optional[float]&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This is because <code>self.k</code> has a type of <code>Optional[float]</code> which means <code>self.k</code> may be <code>float</code> or <code>None</code> and <code>+</code> or <code>*</code> does not support <code>None</code> type variable. In my code's logic, if <code>self.a</code> is <code>None</code>, <code>self.k</code> and <code>self.b</code> must not be <code>None</code>. But I cannot find a way to tell mypy about this rule. The only workaround I found is that add <code>--no-strict-optional</code> to your mypy command. So that, when mypy checks your code, it will not strictly check <code>Optional</code> types. More details can be found <a href="https://mypy.readthedocs.io/en/stable/common_issues.html#unexpected-errors-about-none-and-or-optional-types" target="_blank" rel="noopener noreferrer">here<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="item-xxx-of-union-xxx-yyy-has-no-attribute-zzz"><a href="#item-xxx-of-union-xxx-yyy-has-no-attribute-zzz" aria-hidden="true" class="header-anchor">#</a> Item &quot;xxx&quot; of &quot;Union[xxx, yyy]&quot; has no attribute &quot;zzz&quot;</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> typing <span class="token keyword">import</span> Dict<span class="token punctuation">,</span> Union<span class="token punctuation">,</span> List

char<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Union<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
char<span class="token punctuation">[</span><span class="token string">&quot;char&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span>
char<span class="token punctuation">[</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
char<span class="token punctuation">[</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>In the above code, mypy complains:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>example.py:6: error: Item &quot;str&quot; of &quot;Union[str, List[str]]&quot; has no attribute &quot;append&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Indeed, <code>str</code> type does not have attribute <code>append</code>. Since python is a dynamic language, before it is run, you would not know what a variable's type is. So, mypy cannot decide  <code>char[&quot;list&quot;]</code> is a <code>list</code> or <code>str</code> during static type checking. There are 2 solutions to this problem:</p> <ol><li><p>Use <code>Any</code> instead of <code>Union</code>.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> typing <span class="token keyword">import</span> Any

char<span class="token punctuation">:</span> Dict<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">,</span> Any<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
char<span class="token punctuation">[</span><span class="token string">&quot;char&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span>
char<span class="token punctuation">[</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
char<span class="token punctuation">[</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>Any</code> means any type, it basically disables further type checking for values <code>char</code>.</p></li> <li><p>Use <code>TypedDict</code> from <code>mypy_extensions</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> typing <span class="token keyword">import</span> List
<span class="token keyword">from</span> mypy_extensions <span class="token keyword">import</span> TypedDict

MyDict <span class="token operator">=</span> TypedDict<span class="token punctuation">(</span><span class="token string">&quot;MyDict&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;char&quot;</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

char<span class="token punctuation">:</span> MyDict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;char&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
char<span class="token punctuation">[</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>With usage of <code>TypedDict</code>, it binds type to each <code>value</code> of a dict by its <code>key</code>.</p></li></ol> <p>I personally recommand the second solution, since it is more type-safe. Howerver, it does have some drawbacks:</p> <ol><li>You have to import extra module.</li> <li><code>TypedDict</code> is implemented by mypy, it may not be handled correctly by other static type checker.</li></ol></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/6/2019, 7:53:11 AM</span></div></div> <!----> </div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4e97592e.js" defer></script><script src="/assets/js/2.015f60de.js" defer></script><script src="/assets/js/7.1fc22ddf.js" defer></script>
  </body>
</html>
